services:
  # === Backend: FastAPI ===
  - type: web
    name: pet-med-ai-backend
    env: python
    plan: starter
    rootDir: backend
    buildCommand: |
      pip install -U pip wheel
      pip install -r requirements.txt
    startCommand: |
      uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /healthz
    autoDeploy: true
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.9"
      - key: KB_ROOT
        value: /app/knowledge-base
      # 如有数据库再在控制台设置：
      # - key: DATABASE_URL
      #   sync: false

  # === Frontend: Vite/React (Node serve 静态文件) ===
  - type: web
    name: pet-med-ai-frontend-v6
    env: node
    plan: starter
    rootDir: frontend
    buildCommand: |
      npm ci
      npm run build
    startCommand: npx serve -s dist -l $PORT
    autoDeploy: true
    envVars:
      - key: NODE_VERSION
        value: "20"
      # 部署完成后，把它改成后端实际域名（Render 后端上线后可在控制台复制）
      - key: VITE_API_BASE
        value: https://pet-med-ai-backend.onrender.com
